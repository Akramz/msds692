# Authenticating REST APIs

**Problem:** We can register with the website so that it allows us to pull from its APIs, but what about pulling from a specific user's account, such as at Facebook or Instagram? We need a way for the program to access private data without acquiring and saving their credentials, as we do with our simple API IDs (Zillow, youtube, ...). Enter OAuth2.

## OAuth2

When it comes to a data collection program (the *client*), most REST APIs will require the program to authenticate using OAuth2.  A *resource owner*, such as a Facebook or twitter user, has data stored on a *resource server*. The **key idea** is that the Facebook user should not have to give their login credentials to a client program so that the client can login. Instead, the client gets an access token from an *authorization server* (usually just another server at target company) with approval (e.g., logging in with a dialog box) from the resource owner (Facebook user). Given the access token, the client code can access resources from the resource server.

Here is what the authorization looks like for LinkedIn:
 
<img src=figures/linkedin-allow.png width=300>

This sequence is a tricky thing to get right but the basic idea is as follows.

1. The client program developer goes to a target company's developer website, such as twitter, and asks for an application ID or some other ID that will allow them access to the API. You might also get a so-called secret key from the company.
1. The client program contacts a URL on the  authorization server at the target company to request access using the application ID and usually a secret key.
1. The  authorization server at that URL accepts the credentials and sends an access token back to the  client program via a URL typically specified in the application settings on the target company's developer dashboard or as a `redirect_uri` parameter on the authentication request. As you can see in my examples, authentication requires that your  client pretend to be a web server for one HTTP request, to collect to the access token generated by the target company server.
1. The client program can then make REST API calls using the access token, usually for a limited period of time.

 From the [OAuth 2 document](https://tools.ietf.org/html/rfc6749):
 
```
     +--------+                               +---------------+
     |        |--(A)- Authorization Request ->|   Resource    |
     |        |                               |     Owner     |
     |        |<-(B)-- Authorization Grant ---|               |
     |        |                               +---------------+
     |        |
     |        |                               +---------------+
     |        |--(C)-- Authorization Grant -->| Authorization |
     | Client |                               |     Server    |
     |        |<-(D)----- Access Token -------|               |
     |        |                               +---------------+
     |        |
     |        |                               +---------------+
     |        |--(E)----- Access Token ------>|    Resource   |
     |        |                               |     Server    |
     |        |<-(F)--- Protected Resource ---|               |
     +--------+                               +---------------+
```

Here is [Twitter's Application authentication diagram](https://dev.twitter.com/oauth/application-only)

<img src="https://g.twimg.com/dev/documentation/image/appauth_0.png" width=700>
